import{bm as T,a as u,ac as v,aL as N,e as A,m as S,aM as M,i as L,bz as R,p as B,S as V,z as k,y as m,br as D,bP as H}from"./index.esm.min.940686fb.js";var s=T();function O(e){var t=e.mainData,a=e.datas;a||(a={main:t},e.datasAttr={main:"data"}),e.datas=e.mainData=null,x(t,a,e),u(a,function(r){u(t.TRANSFERABLE_METHODS,function(n){r.wrapMethod(n,v(P,e))})}),t.wrapMethod("cloneShallow",v(_,e)),u(t.CHANGABLE_METHODS,function(r){t.wrapMethod(r,v(E,e))}),N(a[t.dataType]===t)}function P(e,t){if(b(this)){var a=A({},s(this).datas);a[this.dataType]=t,x(t,a,e)}else g(t,this.dataType,s(this).mainData,e);return t}function E(e,t){return e.struct&&e.struct.update(),t}function _(e,t){return u(s(t).datas,function(a,r){a!==t&&g(a.cloneShallow(),r,t,e)}),t}function C(e){var t=s(this).mainData;return e==null||t==null?t:s(t).datas[e]}function F(){var e=s(this).mainData;return e==null?[{data:e}]:S(M(s(e).datas),function(t){return{type:t,data:s(e).datas[t]}})}function b(e){return s(e).mainData===e}function x(e,t,a){s(e).datas={},u(t,function(r,n){g(r,n,e,a)})}function g(e,t,a,r){s(a).datas[t]=e,s(e).mainData=a,e.dataType=t,r.struct&&(e[r.structAttr]=r.struct,r.struct[r.datasAttr[t]]=e),e.getLinkedData=C,e.getLinkedDataAll=F}var j=function(){function e(t,a){this.depth=0,this.height=0,this.dataIndex=-1,this.children=[],this.viewChildren=[],this.isExpand=!1,this.name=t||"",this.hostTree=a}return e.prototype.isRemoved=function(){return this.dataIndex<0},e.prototype.eachNode=function(t,a,r){k(t)&&(r=a,a=t,t=null),t=t||{},m(t)&&(t={order:t});var n=t.order||"preorder",i=this[t.attr||"children"],o;n==="preorder"&&(o=a.call(r,this));for(var h=0;!o&&h<i.length;h++)i[h].eachNode(t,a,r);n==="postorder"&&a.call(r,this)},e.prototype.updateDepthAndHeight=function(t){var a=0;this.depth=t;for(var r=0;r<this.children.length;r++){var n=this.children[r];n.updateDepthAndHeight(t+1),n.height>a&&(a=n.height)}this.height=a+1},e.prototype.getNodeById=function(t){if(this.getId()===t)return this;for(var a=0,r=this.children,n=r.length;a<n;a++){var i=r[a].getNodeById(t);if(i)return i}},e.prototype.contains=function(t){if(t===this)return!0;for(var a=0,r=this.children,n=r.length;a<n;a++){var i=r[a].contains(t);if(i)return i}},e.prototype.getAncestors=function(t){for(var a=[],r=t?this:this.parentNode;r;)a.push(r),r=r.parentNode;return a.reverse(),a},e.prototype.getAncestorsIndices=function(){for(var t=[],a=this;a;)t.push(a.dataIndex),a=a.parentNode;return t.reverse(),t},e.prototype.getDescendantIndices=function(){var t=[];return this.eachNode(function(a){t.push(a.dataIndex)}),t},e.prototype.getValue=function(t){var a=this.hostTree.data;return a.getStore().get(a.getDimensionIndex(t||"value"),this.dataIndex)},e.prototype.setLayout=function(t,a){this.dataIndex>=0&&this.hostTree.data.setItemLayout(this.dataIndex,t,a)},e.prototype.getLayout=function(){return this.hostTree.data.getItemLayout(this.dataIndex)},e.prototype.getModel=function(t){if(!(this.dataIndex<0)){var a=this.hostTree,r=a.data.getItemModel(this.dataIndex);return r.getModel(t)}},e.prototype.getLevelModel=function(){return(this.hostTree.levelModels||[])[this.depth]},e.prototype.setVisual=function(t,a){this.dataIndex>=0&&this.hostTree.data.setItemVisual(this.dataIndex,t,a)},e.prototype.getVisual=function(t){return this.hostTree.data.getItemVisual(this.dataIndex,t)},e.prototype.getRawIndex=function(){return this.hostTree.data.getRawIndex(this.dataIndex)},e.prototype.getId=function(){return this.hostTree.data.getId(this.dataIndex)},e.prototype.getChildIndex=function(){if(this.parentNode){for(var t=this.parentNode.children,a=0;a<t.length;++a)if(t[a]===this)return a;return-1}return-1},e.prototype.isAncestorOf=function(t){for(var a=t.parentNode;a;){if(a===this)return!0;a=a.parentNode}return!1},e.prototype.isDescendantOf=function(t){return t!==this&&t.isAncestorOf(this)},e}(),z=function(){function e(t){this.type="tree",this._nodes=[],this.hostModel=t}return e.prototype.eachNode=function(t,a,r){this.root.eachNode(t,a,r)},e.prototype.getNodeByDataIndex=function(t){var a=this.data.getRawIndex(t);return this._nodes[a]},e.prototype.getNodeById=function(t){return this.root.getNodeById(t)},e.prototype.update=function(){for(var t=this.data,a=this._nodes,r=0,n=a.length;r<n;r++)a[r].dataIndex=-1;for(var r=0,n=t.count();r<n;r++)a[t.getRawIndex(r)].dataIndex=r},e.prototype.clearLayouts=function(){this.data.clearItemLayouts()},e.createTree=function(t,a,r){var n=new e(a),i=[],o=1;h(t);function h(d,I){var y=d.value;o=Math.max(o,L(y)?y.length:1),i.push(d);var c=new j(R(d.name,""),n);I?G(c,I):n.root=c,n._nodes.push(c);var l=d.children;if(l)for(var p=0;p<l.length;p++)h(l[p],c)}n.root.updateDepthAndHeight(0);var w=B(i,{coordDimensions:["value"],dimensionsCount:o}).dimensions,f=new V(w,a);return f.initData(i),r&&r(f),O({mainData:f,struct:n,structAttr:"tree"}),n.update(),n},e}();function G(e,t){var a=t.children;e.parentNode!==t&&(a.push(e),e.parentNode=t)}var J=z;function K(e,t,a){if(e&&D(t,e.type)>=0){var r=a.getData().tree.root,n=e.targetNode;if(m(n)&&(n=r.getNodeById(n)),n&&r.contains(n))return{node:n};var i=e.targetNodeId;if(i!=null&&(n=r.getNodeById(i)))return{node:n}}}function $(e){for(var t=[];e;)e=e.parentNode,e&&t.push(e);return t.reverse()}function Q(e,t){var a=$(e);return D(a,t)>=0}function U(e,t){for(var a=[];e;){var r=e.dataIndex;a.push({name:e.name,dataIndex:r,value:t.getRawValue(r)}),e=e.parentNode}return a.reverse(),a}function W(e){var t=e.getData(),a=t.tree,r={};a.eachNode(function(n){for(var i=n;i&&i.depth>1;)i=i.parentNode;var o=H(e.ecModel,i.name||i.dataIndex+"",r);n.setVisual("decal",o)})}export{J as T,Q as a,W as e,$ as g,K as r,U as w};
