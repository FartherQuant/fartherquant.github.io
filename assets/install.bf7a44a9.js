import{_ as $,a6 as Q,aF as ut,e as _,bR as ct,a as C,aI as vt,c as ht,u as ft,s as gt,t as dt,b0 as pt,bS as j,bT as yt,ab as mt,Q as bt,bD as It,ac as z,bG as St,C as Pt,m as B,M as Tt,w as xt,i as E,L as R,z as wt,y as At,bU as Mt}from"./index.esm.min.940686fb.js";import{g as tt}from"./sectorHelper.8ff1975b.js";import{r as et,a as Dt,T as Vt,w as _t,e as Lt}from"./enableAriaDecalForTree.0f40b34a.js";import{d as Rt}from"./dataFilter.5408e6c9.js";var Ct=2,kt=4,Ft=function(l){$(i,l);function i(t,a,r,o){var e=l.call(this)||this;e.z2=Ct,e.textConfig={inside:!0},Q(e).seriesIndex=a.seriesIndex;var s=new ut({z2:kt,silent:t.getModel().get(["label","silent"])});return e.setTextContent(s),e.updateData(!0,t,a,r,o),e}return i.prototype.updateData=function(t,a,r,o,e){this.node=a,a.piece=this,r=r||this._seriesModel,o=o||this._ecModel;var s=this;Q(s).dataIndex=a.dataIndex;var u=a.getModel(),f=u.getModel("emphasis"),d=a.getLayout(),h=_({},d);h.label=null;var p=a.getVisual("style");p.lineJoin="bevel";var T=a.getVisual("decal");T&&(p.decal=ct(T,e));var x=tt(u.getModel("itemStyle"),h,!0);_(h,x),C(vt,function(n){var c=s.ensureState(n),v=u.getModel([n,"itemStyle"]);c.style=v.getItemStyle();var m=tt(v,h);m&&(c.shape=m)}),t?(s.setShape(h),s.shape.r=d.r0,ht(s,{shape:{r:d.r}},r,a.dataIndex)):(ft(s,{shape:h},r),gt(s)),s.useStyle(p),this._updateLabel(r);var w=u.getShallow("cursor");w&&s.attr("cursor",w),this._seriesModel=r||this._seriesModel,this._ecModel=o||this._ecModel;var g=f.get("focus"),y=g==="ancestor"?a.getAncestorsIndices():g==="descendant"?a.getDescendantIndices():g;dt(this,y,f.get("blurScope"),f.get("disabled"))},i.prototype._updateLabel=function(t){var a=this,r=this.node.getModel(),o=r.getModel("label"),e=this.node.getLayout(),s=e.endAngle-e.startAngle,u=(e.startAngle+e.endAngle)/2,f=Math.cos(u),d=Math.sin(u),h=this,p=h.getTextContent(),T=this.node.dataIndex,x=o.get("minAngle")/180*Math.PI,w=o.get("show")&&!(x!=null&&Math.abs(s)<x);p.ignore=!w,C(yt,function(y){var n=y==="normal"?r.getModel("label"):r.getModel([y,"label"]),c=y==="normal",v=c?p:p.ensureState(y),m=t.getFormattedLabel(T,y);c&&(m=m||a.node.name),v.style=pt(n,{},null,y!=="normal",!0),m&&(v.style.text=m);var S=n.get("show");S!=null&&!c&&(v.ignore=!S);var D=g(n,"position"),M=c?h:h.states[y],V=M.style.fill;M.textConfig={outsideFill:n.get("color")==="inherit"?V:null,inside:D!=="outside"};var A,k=g(n,"distance")||0,I=g(n,"align");D==="outside"?(A=e.r+k,I=u>Math.PI/2?"right":"left"):!I||I==="center"?(s===2*Math.PI&&e.r0===0?A=0:A=(e.r+e.r0)/2,I="center"):I==="left"?(A=e.r0+k,u>Math.PI/2&&(I="right")):I==="right"&&(A=e.r-k,u>Math.PI/2&&(I="left")),v.style.align=I,v.style.verticalAlign=g(n,"verticalAlign")||"middle",v.x=A*f+e.cx,v.y=A*d+e.cy;var L=g(n,"rotate"),b=0;L==="radial"?(b=j(-u),b>Math.PI/2&&b<Math.PI*1.5&&(b+=Math.PI)):L==="tangential"?(b=Math.PI/2-u,b>Math.PI/2?b-=Math.PI:b<-Math.PI/2&&(b+=Math.PI)):bt(L)&&(b=L*Math.PI/180),v.rotation=j(b)});function g(y,n){var c=y.get(n);return c==null?o.get(n):c}p.dirtyStyle()},i}(mt),at=Ft,q="sunburstRootToNode",rt="sunburstHighlight",Et="sunburstUnhighlight";function Ot(l){l.registerAction({type:q,update:"updateView"},function(i,t){t.eachComponent({mainType:"series",subType:"sunburst",query:i},a);function a(r,o){var e=et(i,[q],r);if(e){var s=r.getViewRoot();s&&(i.direction=Dt(s,e.node)?"rollUp":"drillDown"),r.resetViewRoot(e.node)}}}),l.registerAction({type:rt,update:"none"},function(i,t,a){i=_({},i),t.eachComponent({mainType:"series",subType:"sunburst",query:i},r);function r(o){var e=et(i,[rt],o);e&&(i.dataIndex=e.node.dataIndex)}a.dispatchAction(_(i,{type:"highlight"}))}),l.registerAction({type:Et,update:"updateView"},function(i,t,a){i=_({},i),a.dispatchAction(_(i,{type:"downplay"}))})}var Ut=function(l){$(i,l);function i(){var t=l!==null&&l.apply(this,arguments)||this;return t.type=i.type,t}return i.prototype.render=function(t,a,r,o){var e=this;this.seriesModel=t,this.api=r,this.ecModel=a;var s=t.getData(),u=s.tree.root,f=t.getViewRoot(),d=this.group,h=t.get("renderLabelForZeroData"),p=[];f.eachNode(function(n){p.push(n)});var T=this._oldChildren||[];x(p,T),y(u,f),this._initEvents(),this._oldChildren=p;function x(n,c){if(n.length===0&&c.length===0)return;new It(c,n,v,v).add(m).update(m).remove(z(m,null)).execute();function v(S){return S.getId()}function m(S,D){var M=S==null?null:n[S],V=D==null?null:c[D];w(M,V)}}function w(n,c){if(!h&&n&&!n.getValue()&&(n=null),n!==u&&c!==u){if(c&&c.piece)n?(c.piece.updateData(!1,n,t,a,r),s.setItemGraphicEl(n.dataIndex,c.piece)):g(c);else if(n){var v=new at(n,t,a,r);d.add(v),s.setItemGraphicEl(n.dataIndex,v)}}}function g(n){!n||n.piece&&(d.remove(n.piece),n.piece=null)}function y(n,c){c.depth>0?(e.virtualPiece?e.virtualPiece.updateData(!1,n,t,a,r):(e.virtualPiece=new at(n,t,a,r),d.add(e.virtualPiece)),c.piece.off("click"),e.virtualPiece.on("click",function(v){e._rootToNode(c.parentNode)})):e.virtualPiece&&(d.remove(e.virtualPiece),e.virtualPiece=null)}},i.prototype._initEvents=function(){var t=this;this.group.off("click"),this.group.on("click",function(a){var r=!1,o=t.seriesModel.getViewRoot();o.eachNode(function(e){if(!r&&e.piece&&e.piece===a.target){var s=e.getModel().get("nodeClick");if(s==="rootToNode")t._rootToNode(e);else if(s==="link"){var u=e.getModel(),f=u.get("link");if(f){var d=u.get("target",!0)||"_blank";St(f,d)}}r=!0}})})},i.prototype._rootToNode=function(t){t!==this.seriesModel.getViewRoot()&&this.api.dispatchAction({type:q,from:this.uid,seriesId:this.seriesModel.id,targetNode:t})},i.prototype.containPoint=function(t,a){var r=a.getData(),o=r.getItemLayout(0);if(o){var e=t[0]-o.cx,s=t[1]-o.cy,u=Math.sqrt(e*e+s*s);return u<=o.r&&u>=o.r0}},i.type="sunburst",i}(Pt),Ht=Ut,Nt=function(l){$(i,l);function i(){var t=l!==null&&l.apply(this,arguments)||this;return t.type=i.type,t.ignoreStyleOnData=!0,t}return i.prototype.getInitialData=function(t,a){var r={name:t.name,children:t.data};nt(r);var o=this._levelModels=B(t.levels||[],function(u){return new Tt(u,this,a)},this),e=Vt.createTree(r,this,s);function s(u){u.wrapMethod("getItemModel",function(f,d){var h=e.getNodeByDataIndex(d),p=o[h.depth];return p&&(f.parentModel=p),f})}return e.data},i.prototype.optionUpdated=function(){this.resetViewRoot()},i.prototype.getDataParams=function(t){var a=l.prototype.getDataParams.apply(this,arguments),r=this.getData().tree.getNodeByDataIndex(t);return a.treePathInfo=_t(r,this),a},i.prototype.getLevelModel=function(t){return this._levelModels&&this._levelModels[t.depth]},i.prototype.getViewRoot=function(){return this._viewRoot},i.prototype.resetViewRoot=function(t){t?this._viewRoot=t:t=this._viewRoot;var a=this.getRawData().tree.root;(!t||t!==a&&!a.contains(t))&&(this._viewRoot=a)},i.prototype.enableAriaDecal=function(){Lt(this)},i.type="series.sunburst",i.defaultOption={z:2,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,stillShowZeroSum:!0,nodeClick:"rootToNode",renderLabelForZeroData:!1,label:{rotate:"radial",show:!0,opacity:1,align:"center",position:"inside",distance:5,silent:!0},itemStyle:{borderWidth:1,borderColor:"white",borderType:"solid",shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0.2)",shadowOffsetX:0,shadowOffsetY:0,opacity:1},emphasis:{focus:"descendant"},blur:{itemStyle:{opacity:.2},label:{opacity:.1}},animationType:"expansion",animationDuration:1e3,animationDurationUpdate:500,data:[],sort:"desc"},i}(xt);function nt(l){var i=0;C(l.children,function(a){nt(a);var r=a.value;E(r)&&(r=r[0]),i+=r});var t=l.value;E(t)&&(t=t[0]),(t==null||isNaN(t))&&(t=i),t<0&&(t=0),E(l.value)?l.value[0]=t:l.value=t}var Zt=Nt,it=Math.PI/180;function Gt(l,i,t){i.eachSeriesByType(l,function(a){var r=a.get("center"),o=a.get("radius");E(o)||(o=[0,o]),E(r)||(r=[r,r]);var e=t.getWidth(),s=t.getHeight(),u=Math.min(e,s),f=R(r[0],e),d=R(r[1],s),h=R(o[0],u/2),p=R(o[1],u/2),T=-a.get("startAngle")*it,x=a.get("minAngle")*it,w=a.getData().tree.root,g=a.getViewRoot(),y=g.depth,n=a.get("sort");n!=null&&ot(g,n);var c=0;C(g.children,function(P){!isNaN(P.getValue())&&c++});var v=g.getValue(),m=Math.PI/(v||c)*2,S=g.depth>0,D=g.height-(S?-1:1),M=(p-h)/(D||1),V=a.get("clockwise"),A=a.get("stillShowZeroSum"),k=V?1:-1,I=function(P,F){if(!!P){var H=F;if(P!==w){var lt=P.getValue(),O=v===0&&A?m:lt*m;O<x&&(O=x),H=F+k*O;var X=P.depth-y-(S?-1:1),Y=h+M*X,J=h+M*(X+1),U=a.getLevelModel(P);if(U){var N=U.get("r0",!0),Z=U.get("r",!0),G=U.get("radius",!0);G!=null&&(N=G[0],Z=G[1]),N!=null&&(Y=R(N,u/2)),Z!=null&&(J=R(Z,u/2))}P.setLayout({angle:O,startAngle:F,endAngle:H,clockwise:V,cx:f,cy:d,r0:Y,r:J})}if(P.children&&P.children.length){var K=0;C(P.children,function(st){K+=I(st,F+K)})}return H-F}};if(S){var L=h,b=h+M,W=Math.PI*2;w.setLayout({angle:W,startAngle:T,endAngle:T+W,clockwise:V,cx:f,cy:d,r0:L,r:b})}I(g,T)})}function ot(l,i){var t=l.children||[];l.children=zt(t,i),t.length&&C(l.children,function(a){ot(a,i)})}function zt(l,i){if(wt(i)){var t=B(l,function(r,o){var e=r.getValue();return{params:{depth:r.depth,height:r.height,dataIndex:r.dataIndex,getValue:function(){return e}},index:o}});return t.sort(function(r,o){return i(r.params,o.params)}),B(t,function(r){return l[r.index]})}else{var a=i==="asc";return l.sort(function(r,o){var e=(r.getValue()-o.getValue())*(a?1:-1);return e===0?(r.dataIndex-o.dataIndex)*(a?-1:1):e})}}function Bt(l){var i={};function t(a,r,o){for(var e=a;e&&e.depth>1;)e=e.parentNode;var s=r.getColorFromPalette(e.name||e.dataIndex+"",i);return a.depth>1&&At(s)&&(s=Mt(s,(a.depth-1)/(o-1)*.5)),s}l.eachSeriesByType("sunburst",function(a){var r=a.getData(),o=r.tree;o.eachNode(function(e){var s=e.getModel(),u=s.getModel("itemStyle").getItemStyle();u.fill||(u.fill=t(e,a,o.root.height));var f=r.ensureUniqueItemVisual(e.dataIndex,"style");_(f,u)})})}function Yt(l){l.registerChartView(Ht),l.registerSeriesModel(Zt),l.registerLayout(z(Gt,"sunburst")),l.registerProcessor(z(Rt,"sunburst")),l.registerVisual(Bt),Ot(l)}export{Yt as i};
