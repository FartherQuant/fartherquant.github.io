import{bQ as L,_ as W,a3 as $,aa as Z,k as G,a7 as B,j,t as Q,Z as U,C as q,m as F,ao as J,w as K}from"./index.esm.min.283e8c3a.js";import{c as X}from"./install.e352ecbb.js";var Y=256,M=function(){function s(){this.blurSize=30,this.pointSize=20,this.maxOpacity=1,this.minOpacity=0,this._gradientPixels={inRange:null,outOfRange:null};var e=L.createCanvas();this.canvas=e}return s.prototype.update=function(e,t,r,a,o,i){var n=this._getBrush(),h=this._getGradient(o,"inRange"),y=this._getGradient(o,"outOfRange"),u=this.pointSize+this.blurSize,p=this.canvas,f=p.getContext("2d"),b=e.length;p.width=t,p.height=r;for(var C=0;C<b;++C){var I=e[C],l=I[0],O=I[1],x=I[2],m=a(x);f.globalAlpha=m,f.drawImage(n,l-u,O-u)}if(!p.width||!p.height)return p;for(var R=f.getImageData(0,0,p.width,p.height),S=R.data,c=0,_=S.length,w=this.minOpacity,z=this.maxOpacity,d=z-w;c<_;){var m=S[c+3]/256,g=Math.floor(m*(Y-1))*4;if(m>0){var v=i(m)?h:y;m>0&&(m=m*d+w),S[c++]=v[g],S[c++]=v[g+1],S[c++]=v[g+2],S[c++]=v[g+3]*m*256}else c+=4}return f.putImageData(R,0,0),p},s.prototype._getBrush=function(){var e=this._brushCanvas||(this._brushCanvas=L.createCanvas()),t=this.pointSize+this.blurSize,r=t*2;e.width=r,e.height=r;var a=e.getContext("2d");return a.clearRect(0,0,r,r),a.shadowOffsetX=r,a.shadowBlur=this.blurSize,a.shadowColor="#000",a.beginPath(),a.arc(-t,t,this.pointSize,0,Math.PI*2,!0),a.closePath(),a.fill(),e},s.prototype._getGradient=function(e,t){for(var r=this._gradientPixels,a=r[t]||(r[t]=new Uint8ClampedArray(256*4)),o=[0,0,0,0],i=0,n=0;n<256;n++)e[t](n/255,!0,o),a[i++]=o[0],a[i++]=o[1],a[i++]=o[2],a[i++]=o[3];return a},s}(),tt=M;function et(s,e,t){var r=s[1]-s[0];e=F(e,function(i){return{interval:[(i.interval[0]-s[0])/r,(i.interval[1]-s[0])/r]}});var a=e.length,o=0;return function(i){var n;for(n=o;n<a;n++){var h=e[n].interval;if(h[0]<=i&&i<=h[1]){o=n;break}}if(n===a)for(n=o-1;n>=0;n--){var h=e[n].interval;if(h[0]<=i&&i<=h[1]){o=n;break}}return n>=0&&n<a&&t[n]}}function at(s,e){var t=s[1]-s[0];return e=[(e[0]-s[0])/t,(e[1]-s[0])/t],function(r){return r>=e[0]&&r<=e[1]}}function k(s){var e=s.dimensions;return e[0]==="lng"&&e[1]==="lat"}var rt=function(s){W(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,r,a){var o;r.eachComponent("visualMap",function(n){n.eachTargetSeries(function(h){h===t&&(o=n)})}),this._progressiveEls=null,this.group.removeAll();var i=t.coordinateSystem;i.type==="cartesian2d"||i.type==="calendar"?this._renderOnCartesianAndCalendar(t,a,0,t.getData().count()):k(i)&&this._renderOnGeo(i,t,o,a)},e.prototype.incrementalPrepareRender=function(t,r,a){this.group.removeAll()},e.prototype.incrementalRender=function(t,r,a,o){var i=r.coordinateSystem;i&&(k(i)?this.render(r,a,o):(this._progressiveEls=[],this._renderOnCartesianAndCalendar(r,o,t.start,t.end,!0)))},e.prototype.eachRendered=function(t){$(this._progressiveEls||this.group,t)},e.prototype._renderOnCartesianAndCalendar=function(t,r,a,o,i){var n=t.coordinateSystem,h=Z(n,"cartesian2d"),y,u,p,f;if(h){var b=n.getAxis("x"),C=n.getAxis("y");y=b.getBandWidth()+.5,u=C.getBandWidth()+.5,p=b.scale.getExtent(),f=C.scale.getExtent()}for(var I=this.group,l=t.getData(),O=t.getModel(["emphasis","itemStyle"]).getItemStyle(),x=t.getModel(["blur","itemStyle"]).getItemStyle(),m=t.getModel(["select","itemStyle"]).getItemStyle(),R=t.get(["itemStyle","borderRadius"]),S=G(t),c=t.getModel("emphasis"),_=c.get("focus"),w=c.get("blurScope"),z=c.get("disabled"),d=h?[l.mapDimension("x"),l.mapDimension("y"),l.mapDimension("value")]:[l.mapDimension("time"),l.mapDimension("value")],g=a;g<o;g++){var v=void 0,P=l.getItemVisual(g,"style");if(h){var A=l.get(d[0],g),E=l.get(d[1],g);if(isNaN(l.get(d[2],g))||isNaN(A)||isNaN(E)||A<p[0]||A>p[1]||E<f[0]||E>f[1])continue;var N=n.dataToPoint([A,E]);v=new B({shape:{x:N[0]-y/2,y:N[1]-u/2,width:y,height:u},style:P})}else{if(isNaN(l.get(d[1],g)))continue;v=new B({z2:1,shape:n.dataToRect([l.get(d[0],g)]).contentShape,style:P})}if(l.hasItemOption){var D=l.getItemModel(g),H=D.getModel("emphasis");O=H.getModel("itemStyle").getItemStyle(),x=D.getModel(["blur","itemStyle"]).getItemStyle(),m=D.getModel(["select","itemStyle"]).getItemStyle(),R=D.get(["itemStyle","borderRadius"]),_=H.get("focus"),w=H.get("blurScope"),z=H.get("disabled"),S=G(D)}v.shape.r=R;var V=t.getRawValue(g),T="-";V&&V[2]!=null&&(T=V[2]+""),j(v,S,{labelFetcher:t,labelDataIndex:g,defaultOpacity:P.opacity,defaultText:T}),v.ensureState("emphasis").style=O,v.ensureState("blur").style=x,v.ensureState("select").style=m,Q(v,_,w,z),v.incremental=i,i&&(v.states.emphasis.hoverLayer=!0),I.add(v),l.setItemGraphicEl(g,v),this._progressiveEls&&this._progressiveEls.push(v)}},e.prototype._renderOnGeo=function(t,r,a,o){var i=a.targetVisuals.inRange,n=a.targetVisuals.outOfRange,h=r.getData(),y=this._hmLayer||this._hmLayer||new tt;y.blurSize=r.get("blurSize"),y.pointSize=r.get("pointSize"),y.minOpacity=r.get("minOpacity"),y.maxOpacity=r.get("maxOpacity");var u=t.getViewRect().clone(),p=t.getRoamTransform();u.applyTransform(p);var f=Math.max(u.x,0),b=Math.max(u.y,0),C=Math.min(u.width+u.x,o.getWidth()),I=Math.min(u.height+u.y,o.getHeight()),l=C-f,O=I-b,x=[h.mapDimension("lng"),h.mapDimension("lat"),h.mapDimension("value")],m=h.mapArray(x,function(_,w,z){var d=t.dataToPoint([_,w]);return d[0]-=f,d[1]-=b,d.push(z),d}),R=a.getExtent(),S=a.type==="visualMap.continuous"?at(R,a.option.range):et(R,a.getPieceList(),a.option.selected);y.update(m,l,O,i.color.getNormalizer(),{inRange:i.color.getColorMapper(),outOfRange:n.color.getColorMapper()},S);var c=new U({style:{width:l,height:O,x:f,y:b,image:y.canvas},silent:!0});this.group.add(c)},e.type="heatmap",e}(q),nt=rt,it=function(s){W(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.getInitialData=function(t,r){return X(null,this,{generateCoord:"value"})},e.prototype.preventIncremental=function(){var t=J.get(this.get("coordinateSystem"));if(t&&t.dimensions)return t.dimensions[0]==="lng"&&t.dimensions[1]==="lat"},e.type="series.heatmap",e.dependencies=["grid","geo","calendar"],e.defaultOption={coordinateSystem:"cartesian2d",z:2,geoIndex:0,blurSize:30,pointSize:20,maxOpacity:1,minOpacity:0,select:{itemStyle:{borderColor:"#212121"}}},e}(K),st=it;function ht(s){s.registerChartView(nt),s.registerSeriesModel(st)}export{ht as i};
